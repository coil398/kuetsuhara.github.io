<html>

<head>
<meta charset="utf-8">

<script src="libs/qimessaging/1.0/qimessaging.js"></script>
<script src="libs/qimessaging/1.0/jquery.min.js"></script>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/starter-template.css" rel="stylesheet">

<script>

var self = this;

function connect(){
	console.log("connect push");
	// 入力されたpepperのIPアドレスを取得
	var pepperIp = $("#pepperIP").val();

	// 接続が成功したら、各種プロキシを作成して代入しておく
    var setupIns_ = function(){
    	self.qims.service("ALTextToSpeech").done(function(ins){
    		self.alTextToSpeech = ins;
        });
        self.qims.service("ALAnimatedSpeech").done(function(ins){
    		self.alAnimatedSpeech = ins;
        });
        self.qims.service("ALMotion").done(function(ins){
        	self.alMotion = ins;
        });
        self.qims.service("ALBehaviorManager").done(function(ins){
        	self.alBehavior = ins;
        });


    }

	// pepperへの接続を開始する
	self.qims = new QiSession(pepperIp);
	self.qims.socket()
		// 接続成功したら
		.on('connect', function ()
			{
   	 		self.qims.service("ALTextToSpeech")
   	 			.done(function (tts) 
   	 			{
   	 	        	tts.say("せつぞく、成功しました");
   	 	       });
   	 	       		// 接続成功したら各種セットアップを行う
     	       		setupIns_();

     	       })
     	// 接続失敗したら
        .on('disconnect', function () {
              //self.nowState("切断");
});
}

function hello(){
	console.log("hello");
	this.alAnimatedSpeech.say("はろー");
	
}

function say(){
	console.log("say");
	var value = $("#sayText").val();
	this.alTextToSpeech.say(value);
}

function animatedSay(){
	console.log("say");
	var value = $("#animatedSayText").val();
	this.alAnimatedSpeech.say(value);
}


function move(to){
	
	if (self.alMotion){
		console.log("move to");
		switch (to){
			case 0:
				self.alMotion.moveTo(0, 0, 0.5).fail(function(err){console.log(err);});
				break;
			
			case 1:
				self.alMotion.moveTo(0, 0, -0.5).fail(function(err){console.log(err);});
				break;

			case 2:
				self.alMotion.moveTo(0.1, 0, 0).fail(function(err){console.log(err);});
				break;
			
			case 3:
				self.alMotion.moveTo(-0.1, 0, 0).fail(function(err){console.log(err);});
				break;
			case 4:
				self.alMotion.moveTo(0, 0, 0).fail(function(err){console.log(err);});
				break;
				
		}

	}

}

function action(num){
	switch (num){
		case 0:
			self.alBehavior.stopAllBehaviors();
			break;
		case 1:
			self.alBehavior.runBehavior("animation-5ffd19/HighTouch");
			break;
		case 2:
			self.alBehavior.runBehavior("pepper_self_introduction_waist_sample/.");
			break;
		case 3:
			self.alBehavior.runBehavior("pepper_tongue_twister_sample/.");
			break;
	}
	


}

</script>


</head>

<body>


<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
    
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
 	 
      <a class="navbar-brand" href="#">pepper conrtoller</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
    	<!--
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
  -->
    </div><!--/.nav-collapse -->
  </div>
</nav>



<div class="container">
  <div class="starter-template">
    <h1>pepperをブラウザから動かせます</h1>
    <p class="lead">pepperと同じLANにいるときのみ動きます</p>
  </div>
</div><!-- /.container -->


<div class="container">
<section class = "container">
	<h3>接続</h3>
	<div class = "row">
		<div class="col-xs-3"><label>pepper's IP</label></div>
		<div class="col-xs-7"><input type="text" class="form-control" id="pepperIP" value="192.168.0.4" /></div>
		<div class="col-xs-2"><button onclick="connect()" class="btn btn-primary">接続</button></div>
	</div>
	<h3>喋らせる</h3>

	<div class = "row">
		<div class="col-xs-12" >
			<button onclick="hello()" class="btn btn-success">Hello</button>
		</div>
	</div>

	<div class = "row">
		<div class="col-xs-3"><label>TextMessage</label></div>
		<div class="col-xs-7" ><input type="text" class="form-control" id="sayText" /></div>
		<div class="col-xs-2" ><button onclick="say()" class="btn btn-primary">送信</button></div>
	</div>

	<div class = "row">
		<div class="col-xs-3"><label>AnimatedMessage</label></div>
		<div class="col-xs-7" ><input type="text" class="form-control" id="animatedSayText" /></div>
		<div class="col-xs-2" ><button onclick="animatedSay()" class="btn btn-primary">送信</button></div>
		
	</div>
	<div class = "row">
		<div class="col-xs-12"><span id="helpBlock" class="help-block">Hint:　\vct=0~200\ で声の高さ　\pau=0~\ で待つ</span></div>
	</div>

	<h3>動かす</h3>
	<div class = "row">
		<div class="col-xs-3" ><button onclick="move(0)" class="btn btn-warning">←回転</button></div>
		<div class="col-xs-3" ><button onclick="move(1)" class="btn btn-warning">→回転</button></div>
		<div class="col-xs-3" ><button onclick="move(2)" class="btn btn-info">前進</button></div>
		<div class="col-xs-3" ><button onclick="move(3)" class="btn btn-info">後退</button></div>
	</div>
	<h3>動かす</h3>
	<div class = "row">
		<div class="col-xs-3"><button onclick="action(0)" class="btn btn-success">ストップ</button></div>
		<div class="col-xs-3"><button onclick="action(1)" class="btn btn-success">ハイタッチ</button></div>
		<div class="col-xs-3"><button onclick="action(2)" class="btn btn-success">自己紹介</button></div>
		<div class="col-xs-3"><button onclick="action(3)" class="btn btn-success">早口言葉</button></div>
	</div>
	
</section>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>


</body>

</html>
